
<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">{{page.libname}}</li>
  {% assign ulibnames = site.pages | map: 'libname' | uniq | compact %}
  {% for ulib in ulibnames %}
    {% assign libcnt = forloop.index0 %}
    {% assign docnames = site.pages | where: 'libname', ulibnames[libcnt] | map: 'docname' | uniq | compact %}
<!--    <p> {{ ulibnames[libcnt] }} -- {{docnames}} -->
    {% for adoc in libdocnames %}
      {% assign doccnt = forloop.index0 %}
      <p>Is the libdocnames/adoc loop running:  {{libcnt}}-{{ulib}}.{{doccnt}}-{{adoc}}</p>
      <li>
        <a title="{{adoc}}" href="#">{{adoc}}</a>
      {% assign chapnums =  site.pages | where: 'libname', ulib | where: 'docname', adoc | sort: 'chapnum' | map: 'chapnum' | uniq | compact %}
      {% assign chapnames = site.pages | where: 'libname', ulib | where: 'docname', adoc | sort: 'chapnum' | map: 'chapnam' | uniq | compact %}
      <ul>
      {% for chapnum in chapnums %}
      {% assign chapcounter = forloop.index0 %}
          <li class="subfolders">
          <a title="{{ chapnames[chapcounter] }}" href="#"> {{ chapnames[chapcounter] }}</a>
            <ul>
            {% assign pagenames = site.pages | where: 'libname', ulib | where: 'docname', adoc | where: 'chapnum', chapnum | sort: 'pagenum' | map: 'title' | uniq | compact %}
            {% assign pageurls = site.pages | where: 'libname', ulib | where: 'docname', adoc | where: 'chapnum', chapnum | sort: 'pagenum' | map: 'url' | uniq | compact %}
            {% for apage in pagenames %}
              {% if page.libname == ulib and page.docname == adoc and page.chapnum == chapnums[[forloop.index0]] and page.title == apage %}
                <li class="active"><a title="{{apage}}" href="{{pageurls[forloop.index0] | remove: "/"}}">{{apage}}</a></li>
              {% else %}
                <li><a title="{{apage}}" href="{{pageurls[forloop.index0] | remove: "/"}}">{{apage}}</a></li>
              {% endif %}
            {% endfor %}
            </ul>
          </li>
        {% endfor %}
      </ul>
    </li>
    {% endfor %}
  {% endfor %}
<li> Last rites.  The full contents of the final iteration of every libary/document/chapter/page arrary retreived:</li>
<li> ublibnames: {{ ulibnames }} ------ libcnt: {{ libcnt }}</li>
<li> docnames: {{ docnames }} </li>
<li> chapnames: {{ chapnames }} </li>

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>
