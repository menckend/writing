<!--
lvl1 = topnav button name
lvl2 = sidebar name (same as topnav dropdown list entry, e.g. book or article)
lvl3 = 1st level of entries in sidebar  (eg section or chapter)
lvl4 = 2nd level of entries in sidebar  (eg chapter or page )
lvl5 = 3rd level of entries in sidebar  (e.g  page)
-->

<div class="mencknav">
{% include social_media_icons.html %}
</div>

<!-- <div class="mydocsidebar"> -->
   <div class="mencknav">
      {% unless page.sidebar == null %}
         {% assign sbtitle = site.pages | where: 'l1idx', page.l1idx | where: 'l2idx', page.l2idx | map: 'l2name' | compact | uniq %}
         <div class="productTitle"><p><span style="color: black !important;">{{sbtitle}}</span></p></div>
      {% endunless %}
      {% unless page.url contains 'index.html' %}
            <!-- Get a list of all pages with l1/l2/l3 index values that match *this* page.  (these are *all* the pages that should be in the sidebar)  -->
            {% assign sbpages = site.pages | where: 'l1idx', page.l1idx | where: 'l2idx', page.l2idx | sort: '13idx' %}

            <!-- start building the tree if there *are* any other pages that match *this* page's l1|2 index values. -->
            {% if sbpages.size > 0 %}
               <!-- Get a list of all the unique/sorted l3 indices from sbpages -->
               {% assign sbl3idxes = sbpages | sort: "l3idx" | map: 'l3idx' | compact | uniq %}
               <!-- Loop through all the unique L3 indices and create the first level entries in the sidebar menu -->
               {% if sbl3idxes.size > 0 %}
                  {% for l3ix in sbl3idxes %}
                     <!-- set variables for the l3name and url value that corresponds to the l3index value of the current iteration of the loop -->
                     {% assign l3name = sbpages | where: 'l3idx', l3ix | sort: 'l3idx' | map: 'l3name' | compact | uniq %}
                     {% assign l3url = sbpages | where: 'l3idx', l3ix | sort: 'l3idx' | map: 'url' | compact | uniq %}
                     <!-- Get a list of all the pages with *current* L3 index -->
                     {% assign l3pages = sbpages | where: 'l3idx', l3ix | sort: 'l3idx' %}
                     <!-- Get all the unique L4 indices in pages with *current* L3 index -->
                     {% assign l3-l4idxes = l3pages | sort: "l4idx" | map: 'l4idx' | compact | uniq %}
                     <!-- Testing to see if the current l3 index has an l4 children. -->
                     {% if l3-l4idxes.size > 0 %}
                        <details {% if page.l3idx == l3ix%}open{%endif%}><summary>{{l3name}}</summary>
                           {% for l4ix in l3-l4idxes %}
                              {% assign l4name = l3pages | where: 'l4idx', l4ix | sort: 'l4idx' | map: 'l4name' | compact | uniq %}
                              {% assign l4url = l3pages | where: 'l4idx', l4ix | sort: 'l4idx' | map: 'url' | compact | uniq %}
                              <!-- Get a list of all the pages with *current* L4 index -->
                              {% assign l4pages = l3pages | where: 'l4idx', l4ix | sort: 'l4idx' %}
                              <!-- Get all the unique L5 indices in pages with *current* L3&L4 index -->
                              {% assign l4-l5idxes = l4pages | sort: "l5idx" | map: 'l5idx' | compact | uniq %}
                              {% if l4-l5idxes.size > 0 %}
                                 <details {% if page.l4idx == l4ix AND page.l3idx == l3ix%}open{%endif%}><summary>{{l4name}}</summary>
                                    {% for l5ix in l4-l5idxes %}
                                       {% assign l5name = l4pages | where: 'l5idx', l5ix | sort: 'l5idx' | map: 'l5name' | compact | uniq %}
                                       {% assign l5url = l4pages | where: 'l5idx', l5ix | sort: 'l5idx' | map: 'url' | compact | uniq %}
                                       <p class="l5item{% if page.l5idx == l5ix AND page.l4idx == l4ix AND page.l3idx == l3ix %}active{%endif%}"><a title="{{l5name}}" href="{{l5url[0] | remove: "/"}}">{{l5name}}</a></p>
                                    {% endfor %}
                                 </details>
                              {% else %}
                                 <p class="l4item{% if page.l4idx == l4ix and page.l3idx == l3ix %}active{% endif %}"><a title=" {{l4name}}" href="{{l4url[0] | remove: "/"}}">{{l4name}}</a></p>
                              {% endif %}
                           {% endfor %}
                        </details>
                     {% else %}
                        <p class="l3item{% if page.l3idx == l3ix %}"active"{% endif %}><a title=" {{l3name}}" href="{{l3url[0] | remove: "/"}}">{{l3name}}</a></p>
                     {% endif %}
                  {% endfor %}
               {% else %}
                  <p> Nothing here yet; check back later</p>
               {% endif %}
            {% else %}
               <p> Nothing here yet; check back later</p>
            {% endif %}   
      {% endunless %}
   </div>
<!-- </div> -->
