<!--
lvl1 = topnav button name
lvl2 = sidebar name (same as topnav dropdown list entry, e.g. book or article)
lvl3 = 1st level of entries in sidebar  (eg section or chapter)
lvl4 = 2nd level of entries in sidebar  (eg chapter or page )
lvl5 = 3rd level of entries in sidebar  (e.g  page)
-->

<div class="mydocsidebar background-color: whitesmoke;">
   <div class="sidebar-inner background-color: whitesmoke;">
      {% unless page.sidebar == null %}
         {% assign sbtitle = site.pages | where: 'l1idx', page.l1idx | where: 'l2idx', page.l2idx | map: 'l2name' | compact | uniq %}
         <div class="productTitle">{{sbtitle}} </div>
      {% endunless %}
      {% unless page.url contains 'index.html' %}
         <ul id="docnavsidebar" class="docnav">
            <!-- Get a list of all pages with l1/l2/l3.idx values that match *this* page.  (these are *all* the pages that should be in the sidebar)  -->
            {% assign sbpages = site.pages | where: 'l1idx', page.l1idx | where: 'l2idx', page.l2idx | sort: '13idx' %}
            {% if sbpages.size > 0 %}
               <!-- Get a list of all the unique/sorted l3 indice from sbpages -->
               {% assign sbl3idxes = sbpages | sort: "l3idx" | map: 'l3idx' | compact | uniq %}

               <!-- Loop through all the unique L3 indices and create the first level entries in the sidebar menu -->
               {% if sbl3idxes.size > 0 %}
                  <ul>
                  <li><a> sbl3idxes: {{sbl3idxes}}</a></li
                  {% assign l3ix-lp-cnt == 0 | plus: 0 %}
                  {% for l3ix in sbl3idxes %}
                     {% assign l3name = sbpages | where: 'l3idx', sbl3idxes[l3ix-lp-cnt] | sort: "l3idx" | map: 'l3name' | compact | uniq %}
                     <li><a>{{l3ix}}. {{l3name}}</a>
                        <!-- Get a list of all the pages with *current* L3 index -->
                        {% assign l3pages = sbpages | where: 'l3idx', sbl3idxes[forloop.index0] | sort: "l3idx" %}
                        <!-- Get all the unique L4 indices in pages with *current* L3 index -->
                        {% assign sbl4idxes = l3pages | sort: "l4idx" | map: 'l4idx' | compact | uniq %}
                        <li><a> sbl4idxes: {{sbl4idxes.size}}, {{sbl4idxes}} </a></li>
                        {% if sbl4idxes.size > 0 %}
                           {% assign l4ix-lp-cnt == 0 | plus: 0 %}
                           {% for l4ix in sbl4idxes %}
                              {% assign l4name = l3pages | where: 'l4idx', sbl4idxes[l4ix-lp-cnt] | sort: "l4idx" | map: 'l4name' | compact | uniq %}
                              <li><a>{{l4ix}}. {{l4name}}</a></li>
                              {% assign l4ix-lp-cnt == l4ix-lp-cnt | plus: 1 %}
                           {% endfor %}
                        {% else %}
                          <li><a>No content here yet; check back later</a></li>
                          <li><a> Checking again:  {{l3pages | where: 'l4idx', sbl4idxes[l4ix-lp-cnt] | sort: "l4idx" | map: 'l4name' | compact | uniq }}</a></li>
                        {% endif %}
                     </li>
                     {% assign l3ix-lp-cnt == l3ix-lp-cnt | plus 1 %}
                  {% endfor %}
                  </ul>
               {% else %}
                 <li><a> No content here yet; check back later</a></li>
               {% endif %}
            {% else %}
              <li><a> No content here yet; check back later</a></li>
            {% endif %}
         </ul>
      {% endunless %}
   </div>
</div>

