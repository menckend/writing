<!--   In-page Table of Contents staging  -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 2, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top
  $(window).scrollTop(scroll_target - 0);
  return false
})

});
</script>
<!-- end of in-page TOC staging -->

<!--   In-page page-navigation buttons  -->
{% unless page.pagenav == false %}

<!-- Create previous/next in-page navigation buttons. -->

<!-- Figure out what the terminal-index-level of the current page is (as "mylevel") -->
{% if page.l7name %} {%assign myidx = page.l7idx %} {% assign mylvl = 7 | plus: 0 %} {% else %}
{% if page.l6name %} {%assign myidx = page.l6idx %} {% assign mylvl = 6 | plus: 0 %} {% else %}
{% if page.l5name %} {%assign myidx = page.l5idx %} {% assign mylvl = 5 | plus: 0 %} {% else %}
{% if page.l4name %} {%assign myidx = page.l4idx %} {% assign mylvl = 4 | plus: 0 %} {% else %}
{% if page.l3name %} {%assign myidx = page.l3idx %} {% assign mylvl = 3 | plus: 0 %} {% else %}
{% if page.l2name %} {%assign myidx = page.l2idx %} {% assign mylvl = 2 | plus: 0 %}
{% endif %} {% endif %} {% endif %} {% endif %} {% endif %} {% endif %}

{%assign parentlvl == mylvl | minus: 1 %}

<!-- Build an arry of metadata variable names -->
{% assign idxlvls[0] = l1idx %}
{% assign idxlvls[1] = l2idx %}
{% assign idxlvls[2] = l3idx %}
{% assign idxlvls[3] = l4idx %}
{% assign idxlvls[4] = l5idx %}
{% assign idxlvls[5] = l6idx %}
{% assign idxlvls[6] = l7idx %}

{% assign pgidx[0] = page.l1idx %}
{% assign pgidx[1] = page.l2idx %}
{% assign pgidx[2] = page.l3idx %}
{% assign pgidx[3] = page.l4idx %}
{% assign pgidx[4] = page.l5idx %}
{% assign pgidx[5] = page.l6idx %}
{% assign pgidx[6] = page.l7idx %}



<p>
{% assign neighbors = site.pages %}
{% for idxlvl in idxlvls %}
  {% if pgidx[forloop.index0] > 0 %}
    {% assign neighbors = neighbors | where: idxlvl, pgidx[forloop.index0] %}
    {{ neighbors.size}}.
  {% endif %}
{% endfor %}
</p>

{% for neighbor in neighbors %}
{% endfor %}


  <!-- Get a list of all the page-numbers and their URLs for pages in the same library/document/chapter as the current page -->
  {% assign fullpages = site.pages | where: 'libname', page.libname | where: 'docname', page.docname | where: 'chapnum', page.chapnum, | sort: 'pagenum' %}
  {% assign pagenums = site.pages | where: 'libname', page.libname | where: 'docname', page.docname | where: 'chapnum', page.chapnum, | sort: 'pagenum' | map: 'pagenum' | uniq | compact %}
  {% assign pagecount = site.pages | where: 'libname', page.libname | where: 'docname', page.docname | where: 'chapnum', page.chapnum, | sort: 'pagenum' | map: 'pagenum' | uniq | compact | size  %}
  {% if pagecount > 1 %}
    {% assign hostpagenum = page.pagenum | plus: 0  %}
    {% assign hostpagenumint = page.pagenum | to_i  %}
    {% assign oneless = '' | plus: 0 %}
    {% assign onemore = '' | plus: 0 %}
    {% assign oneless = hostpagenumint | minus: 1 %}
    {% assign onemore = hostpagenumint | plus: 1 %}
    <div class="seriesContext">
      {% for pnumval in pagenums %}
        {% assign flpagenum = pnumval | plus: 0  %}
        {% if flpagenum == oneless %}
          <a href="{{fullpages[forloop.index0].url | remove: '/'}}"><button type="button" class="btn">Previous Page </button></a>
        {% endif %}
        {% if flpagenum == onemore %}
          <a href="{{fullpages[forloop.index0].url | remove: '/'}}"><button type="button" class="btn">Next Page </button></a>
        {% endif %}
      {% endfor %}
      {% if pagecount > 2 %}
        <div class="btn-group">
          <button type="button" data-toggle="dropdown" class="btn dropdown-toggle;">Jump to page <span class="caret"> </span></button>
          <ol class="dropdown-menu">
            {% for pnumval in pagenums %}
              {% assign flpagenum = pnumval | plus: 0  %}
              {%if flpagenum == hostpagenum %}
                <li class="active">â†’{{fullpages[forloop.index0].pagenum}}.{{fullpages[forloop.index0].title}}</li>
              {% else %}
                <li>
                  <a href="{{fullpages[forloop.index0].url | remove: '/'}}">{{fullpages[forloop.index0].pagenum}}. {{fullpages[forloop.index0].title}}</a>
                </li>
              {% endif %}
            {% endfor %}
            </ol>
        </div>
      {% endif %}
    </div>
  {% endif %}
{% endunless %}
<!--   End of in-page page-navigation buttons  -->








            <!-- Get a list of all pages with l1/l2 index values that match *this* page.  (these are *all* the pages that should be in the sidebar)  -->
            {% assign ourpages = site.pages | where: 'l1idx', page.l1idx | where: 'l2idx', page.l2idx | where: '12name', null %}
            <!-- start building the tree if there *are* any other pages that match *this* page's l1|2 index values. -->
            {% if ourpages.size > 0 %}
               <!-- Get a list of all the unique/sorted l3 indices from sbpages -->
               {% assign ourl3idxes = ourpages | where_exp: 'page', 'page.l3name' | sort: 'l3idx' | map: 'l3idx' %}
               <!-- Loop through all the unique L3 indices and create the first level entries in the sidebar menu -->
               {% if ourl3idxes.size > 0 %}
                  {% for l3ix in ourl3idxes %}
                     <!-- Get a list of all the pages with *current* L3 index -->
                     {% assign myl3pages = ourpages | where: 'l3idx', l3ix | sort: 'l3idx' %}
                     <!-- set variables for the l3name and url value that corresponds to the l3index value of the current iteration of the loop -->
                     {% assign myl3name = myl3pages | where: 'l3idx', l3ix | where_exp: 'page', 'page.l3name' | map: 'l3name'%}
                     {% assign myl3url = myl3pages | where: 'l3name', myl3name[0] | map: 'url' | array_to_sentence_string %}
                     <!-- Get all the unique L4 indices in pages with *current* L3 index -->
                     {% assign myl4idxes = myl3pages | where_exp: 'page', 'page.l4name' | sort: 'l4idx' | map: 'l4idx' %}
                     <!-- Testing to see if the current l3 index has any l4 children. -->
                     {% if myl4idxes.size > 0 %}
                        <details class="sbdeet" {% if page.l3idx == l3ix%}open{%endif%}><summary><a title="{{myl3name}}" href="{{myl3url | remove: '/'}}">{{myl3name}}</a></summary>
                           {% for l4ix in myl4idxes %}
                              <!-- Get a list of all the pages with *current* L4 index -->
                              {% assign myl4pages = myl3pages | where: 'l4idx', l4ix %}
                              {% assign myl4name = myl4pages | where: 'l4idx', l4ix | where_exp: 'page', 'page.l4name' | map: 'l4name' %}
                              {% assign myl4url  = myl4pages | where: 'l4name', myl4name[0] | map: 'url' | array_to_sentence_string %}
                              <!-- Get all the unique L5 indices in pages with *current* L3&L4 index -->
                              {% assign myl5idxes = myl4pages | where_exp: 'page', 'page.l5name'| map: 'l5idx' %}
                              {% if myl5idxes.size > 0 %}
                                 <details class="sbdeet deet4" {% if page.l4idx == l4ix and page.l3idx == l3ix %} open{%endif%}><summary><a title="{{myl4name}}" href="{{myl4url | remove: '/'}}">{{myl4name}}</a></summary>
                                    {% for l5ix in myl5idxes %}
                                       {% assign myl5name = myl4pages | where: 'l5idx', l5ix | map: 'l5name' %}
                                       {% assign myl5url = myl4pages | where: 'l5name', myl5name[0] | map: 'url' %}
                                       <p class="l5item{% if page.l5idx == l5ix and page.l4idx == l4ix and page.l3idx == l3ix %}active{%endif%}"><a title="{{myl5name}}" href="{{myl5url[0] | remove: '/'}}">{{myl5name}}</a></p>
                                    {% endfor %}
                                 </details>
                              {% else %}
                                 <p class="l4item{% if page.l4idx == l4ix and page.l3idx == l3ix %}active{% endif %}"><a title="{{myl4name}}" href="{{myl4url | remove: '/'}}">{{myl4name}}</a></p>
                              {% endif %}
                           {% endfor %}
                        </details>
                     {% else %}
                        <p class="l3item{% if page.l3idx == l3ix %}active{% endif %}"><a title=" {{myl3name}}" href="{{myl3url | remove: '/'}}">{{myl3name}}</a></p>
                     {% endif %}
                  {% endfor %}
               {% else %}
                  <p> Nothing here yet; check back later</p>
               {% endif %}
            {% else %}
               <p> Nothing here yet; check back later</p>
            {% endif %}   
















{% unless page.toc == false %}
  {% assign tmparray = page.content | markdownify | split: '</h2>' | size %}
  {% if tmparray > 1 %}
    <details><summary >Table of Contents</summary><div id="toc"></div></details>
  {% endif %}
{% endunless %}
