<!--   In-page Table of Contents staging  -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 2, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top
  $(window).scrollTop(scroll_target - 0);
  return false
})

});
</script>
<!-- end of in-page TOC staging -->

<!--   In-page page-navigation buttons  -->
{% unless page.pagenav == false %}

<!--
<p> Start Debug output (get rid of me later) </p>
-->

  <!-- Create previous/next in-page navigation buttons. -->
  <!-- Figure out what the terminal-index-level of the current page is (as "mylevel") -->
  {% for i in (1..10) %}
    {% assign lvlvar = "l" | append: i | append: "idx" %}
    {% if page[lvlvar] %}
      {% assign myidx = page[lvlvar] %}
      {% assign mylvl = forloop.index %}
    {% endif %}
  {% endfor %}

{% assign mylvl-int = mylvl | to_i %}
{% assign myidx-int = myidx | to_i %}
{% assign parentlvl = '' | plus: 0 %}
{% assign parentlvl = mylvl-int | minus: 1 %}
{% assign nextlvl = mylvl-int | plus: 1 %}

<!-- <p> myidx: {{myidx-int}}.   mylvl: {{mylvl}}.  parentlvl: {{parentlvl}} </p>  -->

<!--  Create collection of "adjacent" pages to this one. -->  

{% assign ngbr_pgs = '' | split: ',' %}
{% assign ngbr_urls = '' | split: ',' %}
{% assign ngbr_names = '' | split: ',' %}

{% assign lp1id = '' | plus: 0 %}
{% assign lp2id = '' | plus: 0 %}
{% assign lp3id = '' | plus: 0 %}
{% assign lp4id = '' | plus: 0 %}


<!-- Loop through all the pages in the site -->
{% for cpg in site.pages %}

  <!-- Start by assuming that each page in site.pages *is* a neighbor page for the current page -->
  {% assign goodpage = 'true' %}

  <!-- Loop through the page-hierarchy levls from 1 up to the parent-level of the active page -->
  {% for i in (1..parentlvl) %}
    {% if goodpage == 'true' %}
      {% assign cmpvar = 'l' | append: i | append: 'idx' %}
      {% if cpg[cmpvar] %}
        {% if cpg[cmpvar] != page[cmpvar] %}
          <!-- Mark the looped page as "not a neighbor", because one of the higher-levels in the hierarchy has a different value than the active page -->
          {% assign goodpage = 'false' %}
        {% endif %}
      {% else %}
          <!-- Mark the looped page as "not a neighbor", because it doesn't even *have* an index for for one higher levels in the hierarchy.  -->
        {% assign goodpage = 'false'%}
      {% endif %}
    {% endif %}
  {% endfor %}

  <!-- Loop through the page-hierarchy levls from the active-page's child-level to the deepest level (10, for now) -->
  {% for k in (nextlvl..10) %}
    {% if goodpage == 'true' %}
      {% assign cmpvar = 'l' | append: k | append: 'idx' %}
      {% if cpg[cmpvar] %}
        {% assign goodpage = 'false' %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% if goodpage == 'true' %}
    {% assign mystr = 'l' | append: mylvl | append: 'idx' %}
    {% assign myval = page[mystr] %}
    {% assign yourval = cpg[mystr] %}
    {% if myval == yourval %}
      {% assign goodpage = 'false' %}
    {% endif %}
  {% endif %}

  <!-- mark the "parent-page"  of the current page as "not a neighbor"  -->
  {% if goodpage == 'true' %}
   {% assign str_aa = 'l' | append: parentlvl | append: 'idx' %}
   {% assign str_bb = 'l' | append: mylvl | append: 'idx' %}
    {% if cpg[str_aa] %}
     {% unless cpg[str_bb] %}
       {% assign goodpage = 'false' %}
     {% endunless %}
    {% endif %}
  {% endif%}

  {% if goodpage == 'true' %}
    {% assign ngbr_pgs = ngbr_pgs | push: forloop.index0 %}
    {% assign ngbr_urls = ngbr_urls | push: cpg[forloop.index0].url %}
    {% assign ngbr_names = ngbr_names | push: cpg[forloop.index0].name %}
  {% endif %}
{% endfor %}

<!--
<p> Neighbor pages ({{ngbr_pgs | size }}) are site.pages indices: {{ngbr_pgs | array_to_sentence_string }} </p>
{% assign ngct = ngbr_pgs | size | minus: 1 %}
{% for j in (0..ngct) %}
{% assign holdme = ngbr_pgs[j]  %}
<p> name/url: {{site.pages.[holdme].name}}|{{site.pages.[holdme].url}}, </p>
{% endfor %}
-->

                                                                                            <p> End Debug output (get rid of me later) </p>


  <!-- Get a list of all the page-numbers and their URLs for pages in the same library/document/chapter as the current page -->

    {% assign hostpagenum = page.pagenum | plus: 0  %}
    {% assign hostpagenumint = page.pagenum | to_i  %}
    {% assign oneless = '' | plus: 0 %}
    {% assign onemore = '' | plus: 0 %}
    {% assign oneless = hostpagenumint | minus: 1 %}
    {% assign onemore = hostpagenumint | plus: 1 %}

    <div class="seriesContext">

          <a href="{{fullpages[forloop.index0].url | remove: '/'}}"><button type="button" class="btn">Previous Page </button></a>
          <a href="{{fullpages[forloop.index0].url | remove: '/'}}"><button type="button" class="btn">Next Page </button></a>


    </div>


        <div class="btn-group">
          <button type="button" data-toggle="dropdown" class="btn dropdown-toggle;">Jump to page <span class="caret"> </span></button>
          <ol class="dropdown-menu">
            {% for pnumval in pagenums %}
              {% assign flpagenum = pnumval | plus: 0  %}
              {%if flpagenum == hostpagenum %}
                <li class="active">→{{fullpages[forloop.index0].pagenum}}.{{fullpages[forloop.index0].title}}</li>
              {% else %}
                <li>
                  <a href="{{fullpages[forloop.index0].url | remove: '/'}}">{{fullpages[forloop.index0].pagenum}}. {{fullpages[forloop.index0].title}}</a>
                </li>
              {% endif %}
            {% endfor %}
            </ol>
        </div>




      {% for pnumval in pagenums %}
        {% assign flpagenum = pnumval | plus: 0  %}
        {% if flpagenum == oneless %}
          <a href="{{fullpages[forloop.index0].url | remove: '/'}}"><button type="button" class="btn">Previous Page </button></a>
        {% endif %}
        {% if flpagenum == onemore %}
          <a href="{{fullpages[forloop.index0].url | remove: '/'}}"><button type="button" class="btn">Next Page </button></a>
        {% endif %}
      {% endfor %}
      {% if pagecount > 2 %}
        <div class="btn-group">
          <button type="button" data-toggle="dropdown" class="btn dropdown-toggle;">Jump to page <span class="caret"> </span></button>
          <ol class="dropdown-menu">
            {% for pnumval in pagenums %}
              {% assign flpagenum = pnumval | plus: 0  %}
              {%if flpagenum == hostpagenum %}
                <li class="active">→{{fullpages[forloop.index0].pagenum}}.{{fullpages[forloop.index0].title}}</li>
              {% else %}
                <li>
                  <a href="{{fullpages[forloop.index0].url | remove: '/'}}">{{fullpages[forloop.index0].pagenum}}. {{fullpages[forloop.index0].title}}</a>
                </li>
              {% endif %}
            {% endfor %}
            </ol>
        </div>
      {% endif %}
    </div>

{% endunless %}

<!--   End of in-page page-navigation buttons  -->

{% unless page.toc == false %}
  {% assign tmparray = page.content | markdownify | split: '</h2>' | size %}
  {% if tmparray > 2 %}
    <details><summary >Table of Contents</summary><div id="toc"></div></details>
  {% endif %}
{% endunless %}
